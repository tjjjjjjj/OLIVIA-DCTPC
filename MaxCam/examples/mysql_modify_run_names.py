# code to read an existing database and modify the "file" column entries
# to change the run names from "dmtpc_runXXXXX.root" to "dmtpc_4sh_XXXXX.root"

import _mysql

db = _mysql.connect(host="rubin.lns.mit.edu", user="dmatter", passwd="seedark", db="DMTPC_WIPP")

db.query("""SELECT file FROM run_desc""")
r = db.store_result()


#timeOfId = {
# 2087: "2010-04-08 11:05:19",
# 2088: "2010-04-11 13:26:55",
# 2089: "2010-04-11 13:39:59",
# 2090: "2010-04-11 13:42:06",
# 2091: "2010-04-11 13:48:08",
# 2092: "2010-04-11 13:55:35"
#}

timeOfId = {
2087:"2010-04-08 11:05:19",
2088:"2010-04-11 13:26:55",
2089:"2010-04-11 13:39:59",
2090:"2010-04-11 13:42:06",
2091:"2010-04-11 13:48:08",
2092:"2010-04-11 13:55:35",
2093:"2010-04-11 13:58:11",
2094:"2010-04-11 13:59:45",
2095:"2010-04-11 14:11:45",
2096:"2010-04-11 17:37:07",
2097:"2010-04-11 18:00:13",
2098:"2010-04-11 18:07:18",
2099:"2010-04-29 15:18:47",
2100:"2010-04-29 15:19:10",
2101:"2010-04-29 15:38:48",
2102:"2010-04-29 15:39:12",
2103:"2010-04-29 15:42:45",
2104:"2010-04-29 15:43:41",
2105:"2010-04-29 15:45:07",
2106:"2010-04-29 15:46:40",
2107:"2010-04-29 15:49:14",
2108:"2010-04-29 22:50:41",
2109:"2010-04-29 23:01:25",
2110:"2010-04-30 13:08:58",
2111:"2010-04-30 16:50:35",
2112:"2010-04-30 17:05:16",
2113:"2010-04-30 17:15:26",
2114:"2010-04-30 17:25:38",
2115:"2010-04-30 17:35:43",
2116:"2010-04-30 17:45:49",
2117:"2010-04-30 17:55:55",
2118:"2010-04-30 18:06:01",
2119:"2010-04-30 18:16:07",
2120:"2010-04-30 18:26:12",
2121:"2010-04-30 18:36:18",
2122:"2010-05-24 11:50:45",
2123:"2010-05-24 15:46:40",
2124:"2010-05-25 15:08:17",
2125:"2010-05-25 16:13:09",
2126:"2010-05-27 17:19:55",
2127:"2010-05-27 17:36:56",
2128:"2010-05-27 17:45:45",
2129:"2010-05-27 17:54:34",
2130:"2010-05-27 18:03:22",
2131:"2010-05-27 18:12:11",
2132:"2010-05-27 18:21:00",
2133:"2010-05-27 18:29:48",
2134:"2010-05-27 18:38:36",
2135:"2010-05-27 18:47:25",
2136:"2010-05-27 18:56:13",
2137:"2010-06-28 11:05:06",
2138:"2010-06-28 11:10:31",
2140:"2010-07-07 12:51:11",
2141:"2010-07-07 12:55:03",
2142:"2010-07-07 13:19:31",
2143:"2010-07-08 12:09:34",
2144:"2010-07-08 12:19:16",
2145:"2010-07-08 12:23:01",
2146:"2010-07-08 12:33:11",
2147:"2010-07-08 12:41:33",
2148:"2010-07-08 12:52:19",
2149:"2010-07-08 13:35:11",
2150:"2010-07-08 13:39:01",
2151:"2010-07-08 16:17:43",
2152:"2010-07-08 18:28:57",
2153:"2010-07-08 19:45:46",
2154:"2010-07-08 21:02:36",
2155:"2010-07-08 22:19:29",
2156:"2010-07-08 23:36:23",
2157:"2010-07-09 19:21:33",
2158:"2010-07-09 20:38:44",
2159:"2010-07-09 21:55:54",
2160:"2010-07-09 23:13:05",
2161:"2010-07-10 00:30:14",
2162:"2010-07-10 01:47:28",
2163:"2010-07-10 03:04:45",
2164:"2010-07-10 04:22:03",
2165:"2010-07-10 05:39:21",
2166:"2010-07-10 06:56:41",
2167:"2010-07-16 15:39:15",
2168:"2010-07-16 17:00:10",
2169:"2010-07-16 18:21:05",
2170:"2010-07-16 19:42:03",
2171:"2010-07-16 21:02:58",
2172:"2010-07-16 22:23:59",
2173:"2010-07-16 23:44:58",
2174:"2010-07-17 01:05:57",
2175:"2010-07-17 02:26:56",
2176:"2010-07-17 03:48:05",
2177:"2010-07-17 05:09:12",
2178:"2010-07-17 06:30:26",
2179:"2010-07-17 07:50:52",
2180:"2010-07-17 09:11:18",
2181:"2010-07-17 10:31:46",
2182:"2010-07-17 11:52:15",
2183:"2010-07-17 13:12:44",
2184:"2010-07-17 14:33:16",
2185:"2010-07-17 15:53:48",
2186:"2010-07-17 17:14:22",
2187:"2010-07-21 01:47:21",
2188:"2010-07-21 03:09:22",
2189:"2010-07-21 04:31:22",
2190:"2010-07-21 05:53:19",
2191:"2010-07-21 07:15:23",
2192:"2010-07-21 08:37:34",
2193:"2010-07-27 13:56:06",
2194:"2010-07-28 12:08:06",
2195:"2010-07-28 13:37:16",
2196:"2010-07-28 15:06:26",
2197:"2010-07-28 16:35:38",
2198:"2010-07-28 18:04:54",
2199:"2010-07-29 14:01:31",
2200:"2010-07-29 15:41:10",
2201:"2010-07-30 12:17:57",
2202:"2010-07-30 14:27:25",
2203:"2010-07-30 16:02:07",
2204:"2010-07-30 17:36:55",
2205:"2010-08-02 16:16:44",
2206:"2010-08-03 11:58:57",
2207:"2010-08-03 13:37:17",
2208:"2010-08-27 09:49:36",
2209:"2010-08-27 10:40:21",
2210:"2010-08-27 13:26:16",
2211:"2010-08-27 16:10:10",
2212:"2010-08-30 15:07:05",
2213:"2010-08-30 15:07:38",
2214:"2010-08-30 15:16:08"

    }

#runnum = 0
id = 2087
while 1:
    row = r.fetch_row()
    if not row: break

    # returns a tuple like this:
    # (('dmtpc_run00126.root',),)
    oldfilename = row[0][0]

    print row
    newfilename = oldfilename.replace("_run", "_4sh_")
    #runnum_str = "%05d" % runnum
    #newfilename = "dmtpc_4sh_"+runnum_str+".root"
    id_str = "%d" % id
    print "    ["+oldfilename+"]"
    print "    ["+newfilename+"]"

    cmd = "UPDATE run_desc SET timestamp=\""+timeOfId[id]+"\", file=\""+newfilename+"\" where id=\""+id_str+"\";"
    print cmd
    db.query(cmd)

    #runnum += 1
    id += 1
    if id == 2139:   # not sure why, but there is no entry w/ id=2139
        id += 1

